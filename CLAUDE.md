# Investment Analysis Knowledge Base

Это база знаний для фундаментального анализа российских компаний. Используй эти документы как контекст при ответах на вопросы об инвестициях.

## Структура проекта

```
investment-analysis/
├── global/           # Мировая экономика
├── russia/           # Макроэкономика РФ
│   ├── macro.md      # ВВП, ставка ЦБ, инфляция
│   ├── currency.md   # Рубль, валютный контроль
│   └── regulations.md # Санкции, налоги
├── sectors/          # Отраслевой анализ
│   └── {sector}/_index.md
├── companies/        # Карточки компаний
│   └── {TICKER}/
│       ├── _index.md   # Наше исследование
│       └── opinions.md # Внешние мнения (аналитики, каналы)
├── sources/          # Внешние источники (автогенерация)
│   └── investopit_russia.md
└── scripts/          # Скрипты для обновления данных
    ├── telegram_scraper.py
    └── generate_opinions.py
```

## Как анализировать компанию

При вопросе о конкретной компании читай документы **снизу вверх**:

1. `companies/{TICKER}/_index.md` — наше исследование: бизнес-модель, метрики, тезис
2. `companies/{TICKER}/opinions.md` — внешние мнения аналитиков (для сравнения)
3. `sectors/{sector}/_index.md` — отраслевой контекст
4. `russia/macro.md` — макроэкономический фон (ставка, инфляция)
5. `russia/currency.md` — если важен валютный фактор
6. `russia/regulations.md` — если есть санкционные/налоговые риски
7. `global/world-economy.md` — внешние факторы

### Структура папки компании

```
companies/{TICKER}/
├── _index.md      # Наше исследование (заполняется вручную)
├── opinions.md    # Внешние мнения (автогенерация из sources/)
└── trend.json     # Вероятности роста/падения для внешнего сервиса (автогенерация)
```

- **_index.md** — основной документ с нашим анализом
- **opinions.md** — агрегированные мнения из Telegram-каналов и других источников (генерируется скриптом)
- **trend.json** — JSON с вероятностями роста/падения для внешнего сервиса (генерируется `scripts/generate_trend_json.py`)

## Формат ответа при анализе

При анализе инвестиционной привлекательности давай структурированный ответ:

1. **Verdict**: bullish / neutral / bearish
2. **Ключевые факторы** (3-5 пунктов)
3. **Риски** (2-3 пункта)
4. **Макро-контекст** (как ставка/инфляция влияют на компанию)
5. **Вывод** (1-2 предложения)

## YAML-метаданные

Каждый документ содержит YAML-frontmatter с ключевыми полями:

- `sentiment`: bullish / neutral / bearish — текущая оценка
- `updated`: дата последнего обновления
- `position`: buy / hold / sell / watch — рекомендация по компании
- `key_risks`, `key_opportunities` — списки рисков и возможностей

Используй эти поля для быстрой оценки без чтения всего документа.

## Как заполнять секторальный анализ

Когда пользователь просит исследовать сектор — сначала прочитай **`sectors/RESEARCH_GUIDE.md`**. Там полная инструкция: порядок работы, поисковые запросы, требования к каждой секции, стандарт качества и анти-паттерны.

Кратко:
1. Прочитай контекст (шаблон, эталон IT-Telecom, макро, существующую заглушку)
2. Проведи веб-исследование (3 раунда: сектор → регуляторика → компании)
3. Заполни `sectors/{sector}/_index.md` секция за секцией
4. Обнови таблицу статуса в `_index.md`

## Как исследовать компанию

Когда пользователь просит проанализировать компанию:
1. Создай **Claude Code Tasks** для каждой фазы (0–8) с зависимостями — структура описана в `companies/RESEARCH_GUIDE.md` → «Отслеживание прогресса через Tasks»
2. Выполняй фазы по порядку, обновляя статус задач (`in_progress` → `completed`). Фазы 1 и 2 можно выполнять параллельно
3. Детали каждой фазы — в `companies/RESEARCH_CHECKLIST.md`. Методология и формулы — в **`companies/RESEARCH_GUIDE.md`**
4. Если Фаза 4 выявила stop-условие — пропусти Фазы 5-6, перейди к оформлению с `position: avoid`

## Как найти спекулятивную идею

Когда пользователь ищет **краткосрочную спекуляцию** (быстрая прибыль, трейд на катализаторе) — используй **`companies/SPECULATIVE_GUIDE.md`**. Там: критерии отбора, Speculative Score, типы идей (ставка на ЦБ, дивидендный гэп, earnings play, валютный хедж), управление позицией, стоп-лоссы.

Кратко:
1. Фильтруй компании: `sentiment: bullish`, `position: buy/watch`, `upside > 20%`
2. Рассчитай Speculative Score (upside + ликвидность + катализатор + волатильность + дивиденды)
3. Определи тип идеи и таймфрейм
4. Проверь календарь катализаторов (заседание ЦБ, отчёты, отсечки)
5. Установи стоп-лосс и тейк-профит до входа в позицию

Ключевые отличия от инвестирования:
- Горизонт: дни-месяцы (не годы)
- Обязателен понятный катализатор с датой
- Стоп-лосс обязателен
- Размер позиции зависит от Score

## Таблица обновлений (`_index.md`)

В корневом файле `_index.md` находится таблица «Статус обновлений» — реестр всех документов базы знаний. При каждом изменении документа обновляй эту таблицу:

### Что обновлять
1. **Статус**: `заглушка` → `частично` → `заполнен` (по мере наполнения)
2. **Обновлён**: дата последнего изменения (должна совпадать с `updated` в YAML документа)
3. **След. обновление**: дата рекомендованного следующего обновления (рассчитывай от частоты)
4. **Частота**: не менять без указания пользователя

### Частота обновлений по типу документа

| Тип | Частота | Триггеры внепланового обновления |
|-----|---------|----------------------------------|
| russia/macro.md | после каждого заседания ЦБ (~8 раз/год) | резкое изменение инфляции, внеплановое заседание |
| russia/currency.md | ежеквартально | движение курса >10%, новые санкции, изменение валютного контроля |
| russia/regulations.md | ежеквартально | новые санкции, налоговые изменения, значимые законы |
| global/world-economy.md | ежеквартально | решения ФРС/ЕЦБ, шоки на рынке нефти, геополитика |
| sectors/{sector} | ежеквартально | выход отраслевой статистики, крупные M&A, регуляторные изменения |
| companies/{TICKER}/_index.md | ежеквартально | публикация отчётности (МСФО/РСБУ), дивидендные решения, корпоративные события |
| companies/{TICKER}/opinions.md | автоматически | запуск `scripts/generate_opinions.py` после обновления sources/ |
| companies/{TICKER}/trend.json | автоматически | запуск `scripts/generate_trend_json.py` после обновления _index.md |
| companies/{TICKER}/data/catalysts.json | автоматически | запуск `scripts/generate_catalysts.py` после обновления key_risks/key_opportunities в _index.md |

### Как рассчитывать «След. обновление»
- Для заполненных документов: дата последнего обновления + период частоты
- Для `macro.md`: дата ближайшего заседания ЦБ (см. таблицу в самом документе)
- Для заглушек и частично заполненных: ставь `—` и пометку `заполнить` в колонке «Частота»
- Когда заглушка заполняется → поставь первую дату «след. обновление» на +3 месяца

### Когда напоминать пользователю
- Если пользователь спрашивает про компанию/сектор, а соответствующий документ **просрочен** (текущая дата > «след. обновление») — сообщи об этом и предложи обновить
- Если при ответе используешь данные из документа старше 6 месяцев — предупреди о возможной неактуальности

## Важно

- **При любом изменении документа** — обязательно обнови таблицу «Статус обновлений» в `_index.md` (статус, дата, след. обновление)
- Если документ не заполнен (пустые ячейки таблиц) — сообщи пользователю, что данных недостаточно
- Обновляй поле `updated` в YAML-метаданных при редактировании документов
- При обнаружении новой информации предлагай обновить соответствующий документ
- При любом изменении в проекте, закоммитить изменения в репозиторий и запушить

## Обновление внешних источников

Для обновления данных из Telegram-каналов используй скрипты в `scripts/`:

```bash
# 1. Скачать новые посты из канала
python3 scripts/telegram_scraper.py investopit investopit_posts.json

# 2. Отфильтровать посты о России
python3 scripts/filter_russia.py

# 3. Сгенерировать opinions.md для каждой компании
python3 scripts/generate_opinions.py

# 4. Обновить trend.json для всех компаний
python3 scripts/generate_trend_json.py
```

Рекомендуемая частота: раз в неделю или после важных событий (отчёты, дивиденды).

### Формат trend.json

Файл `trend.json` содержит вероятности роста/падения для внешнего сервиса:

```json
{
  "ticker": "SBER",
  "sentiment": "bullish",
  "upside": 0.64,
  "growth_probability": 0.70,
  "decline_probability": 0.15,
  "updated": "2026-01-29"
}
```

Алгоритм расчёта вероятностей основан на `sentiment` и `upside` из `_index.md`.
Схема API: `api/trend-schema.yaml`.

Подробная инструкция: `scripts/README.md`

### Формат catalysts.json

Файл `catalysts.json` содержит позитивные и негативные катализаторы для внешнего сервиса:

```json
{
  "ticker": "SBER",
  "company_name": "Сбербанк",
  "generated": "2026-02-25",
  "catalysts": [
    {
      "type": "opportunity",
      "impact": "positive",
      "magnitude": "high",
      "date": null,
      "description": "Снижение ставки ЦБ 16% → 13%",
      "source": "index"
    },
    {
      "type": "cb_meeting",
      "impact": "mixed",
      "magnitude": "high",
      "date": "2026-03-20",
      "description": "Заседание ЦБ по ключевой ставке",
      "source": "macro"
    }
  ],
  "summary": { "total": 10, "positive": 4, "negative": 4, "mixed": 2 }
}
```

Источники: `key_risks` и `key_opportunities` из `_index.md` + заседания ЦБ из `russia/macro.md`.
Схема API: `api/catalysts-schema.yaml`.

Генерация:
```bash
make catalysts                    # все компании
make catalysts TICKER=SBER        # одна компания
```